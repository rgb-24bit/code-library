#+TITLE: Code snippet collection

* Table of Contents                                       :TOC_4_gh:noexport:
- [[#t-sql-related][T-SQL related]]

* T-SQL related
  + Back up the database to disk.
    #+BEGIN_SRC sql
      BACKUP DATABASE db TO DISK = '/path/to/db.bak';
    #+END_SRC

  + Restore database from disk.
    #+BEGIN_SRC sql
      /**
       * If the restore failed because the corresponding attribute was not found, execute
       * RESTORE FILELISTONLY FROM DISK='/path/to/db.bak'
       * Get data file and log file name
       *
       * Note: The target directory must exist
       */
      RESTORE DATABASE db FROM DISK = '/path/to/db.bak'
              WITH MOVE 'db_data' TO '/path/to/db_data.mdf',
                   MOVE 'db_log'  TO '/path/to/db_log.ldf';
    #+END_SRC

  + Delete the database if the database already exists.
    #+BEGIN_SRC sql
      IF EXISTS (SELECT * FROM sys.databases WHERE name = 'db')
         DROP DATABASE db;
    #+END_SRC

  + Create a database and make a save location for the database files.
    #+BEGIN_SRC sql
      CREATE DATABASE db
      ON
      (
        name = db_data,
        filename = '/path/to/db_data.mdf'
      )
      LOG ON
      (
        name = db_log,
        filename = '/path/to/db_log.ldf'
      );
    #+END_SRC

